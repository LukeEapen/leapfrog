<!-- htmlhint doctype-first:false -->
{% extends 'poc4/base.html' %}
{% block content %}
<!-- Banner -->
<div class="bg-danger text-white py-3 mb-4 rounded shadow-sm text-center">
  <h2 class="mb-0">Data Modelling, Migration & Reconciliation</h2>
  <small>Modern Data Migration Workflow</small>
</div>

{% include 'poc4/_subnav.j2' %}
{% include 'poc4/_steps.j2' %}

<style>
  /* Two-column rules layout */
  .rules-table th, .rules-table td { vertical-align: middle; }
  .rules-table thead th { padding: .45rem .55rem; font-weight: 600; }
  .rules-table td { padding: .35rem .5rem; }
  .rules-table td input { font-size: .8rem; padding: .25rem .4rem; }
  .rule-row { font-size: .78rem; }
  .rules-wrapper .card-body { max-height: 72vh; overflow: auto; }
  /* Stacked target field + table name */
  .field-stack strong { display:block; font-size:.8rem; line-height:1.15; }
  .field-stack .tbl { display:block; font-size:.55rem; text-transform:uppercase; letter-spacing:.5px; color:#6c757d; line-height:1; margin-top:2px; }
  .rules-table tbody tr:hover .field-stack strong { color:#b71c1c; }
  /* Example/Variants modern chips */
  .ex-box{background:#f8fafc;border:1px solid #eef2f7;border-left:3px solid #d32f2f;border-radius:.375rem;padding:.3rem .45rem}
  .ex-row{display:flex;align-items:center;gap:.4rem;margin:.1rem 0}
  .ex-line{display:flex;align-items:center;gap:.6rem;flex-wrap:wrap}
  .ex-seg{display:flex;align-items:center;gap:.35rem}
  .ex-label{font-size:.68rem;font-weight:600;color:#6b7280;text-transform:uppercase;letter-spacing:.4px}
  .ex-code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:.78rem; background:#fff; border:1px solid #e5e7eb; border-radius:.25rem; padding:.15rem .35rem; color:#111827}
  .variant-list{display:flex;gap:.45rem;flex-wrap:wrap;align-items:center}
  .variant-link{color:#0d6efd;cursor:pointer;font-size:.75rem;white-space:nowrap}
  .variant-link:hover{text-decoration:underline}
  .variant-sep{color:#9ca3af}
  .variant-toggle{color:#0d6efd;cursor:pointer;font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.4px}
  .variant-toggle:hover{text-decoration:underline}
  /* Small Column 2: Mapping graph */
  .graph-card .mermaid svg{max-width:100%}
  .graph-card .mermaid{min-height:220px}
  /* Mermaid graph sizing handled above; no pre-hide to ensure render */
</style>

<form method="post" id="rules-form">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div class="form-check form-switch small mb-0">
      <input class="form-check-input" type="checkbox" id="toggleQualified" checked>
      <label class="form-check-label" for="toggleQualified">Show table names</label>
    </div>
    <div class="d-flex gap-2 align-items-center">
      <button type="button" class="btn btn-help btn-sm" data-bs-toggle="modal" data-bs-target="#helpModalP3" aria-label="Help about Rules">
        <i class="bi bi-question-circle-fill"></i>
        Help
      </button>
      <button name="action" value="apply_all" class="btn btn-danger btn-sm" type="submit" title="Apply recommended variant to all rules">Apply All recommended</button>
      <button name="action" value="regenerate" class="btn btn-outline-secondary btn-sm" type="submit" formnovalidate title="Rebuild rules from current mapping">Regenerate Rules</button>
      <button name="action" value="next" class="btn btn-danger btn-sm" id="validate-btn">Validate & Simulate</button>
    </div>
  </div>
  <div class="row g-4 rules-wrapper">
    <div class="col-12 col-lg-9">
      <div class="card h-100 shadow-sm">
        <div class="card-header bg-light text-danger fw-bold d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center gap-3">
            <span>Origin ➜ Target Rules</span>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="filter-source">
              <label class="form-check-label" for="filter-source"><span class="badge bg-danger">DATA SOURCE 1</span></label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="filter-legacy">
              <label class="form-check-label" for="filter-legacy"><span class="badge bg-dark">DATA SOURCE 2</span></label>
            </div>
            <button class="btn btn-sm btn-outline-secondary" type="button" id="minimize-source" title="Minimize DS1 rows">Minimize DS1</button>
            <button class="btn btn-sm btn-outline-secondary" type="button" id="minimize-legacy" title="Minimize DS2 rows">Minimize DS2</button>
            {# Dynamic DS3+ chips based on rules origins #}
            {% set ns = namespace(extras=[]) %}
            {% for rule in rules %}
              {% set o = rule.origin %}
              {% if o not in ['source','legacy'] and o not in ns.extras %}
                {% set _ = ns.extras.append(o) %}
              {% endif %}
            {% endfor %}
            {% for o in ns.extras %}
            <div class="form-check form-check-inline align-items-center d-flex gap-1">
              <input class="form-check-input filter-extra" type="checkbox" id="filter-{{ o }}" data-origin="{{ o }}">
              <label class="form-check-label" for="filter-{{ o }}">
                {% if o[:2]|lower == 'ds' %}<span class="badge bg-secondary">DATA SOURCE {{ o[2:]|int }}</span>{% else %}<span class="badge bg-secondary">{{ o|upper }}</span>{% endif %}
              </label>
              <button class="btn btn-xs btn-outline-secondary minimize-extra" type="button" data-origin="{{ o }}" title="Minimize {{ o|upper }} rows">–</button>
            </div>
            {% endfor %}
          </div>
          <div class="d-flex align-items-center gap-2">
            <button name="action" value="apply_all_source" class="btn btn-outline-danger btn-sm" type="submit" title="Apply recommended to all Data Source 1 rules">Apply All (Data Source 1)</button>
            <button name="action" value="apply_all_legacy" class="btn btn-outline-dark btn-sm" type="submit" title="Apply recommended to all Data Source 2 rules">Apply All (Data Source 2)</button>
          </div>
        </div>
        <div class="card-body p-0">
          <table class="table table-sm table-striped table-hover mb-0 rules-table">
            <thead class="table-light">
              <tr class="small">
                <th style="width:90px">Origin</th>
                <th style="min-width:170px">Target Field</th>
                <th style="min-width:140px">Source/Legacy Field(s)</th>
                <th style="min-width:240px">Rule</th>
                <th style="min-width:260px">Example</th>
                <th style="width:50px"></th>
              </tr>
            </thead>
            <tbody>
              {% for rule in rules %}
              <tr class="rule-row" data-origin="{{ rule.origin }}" title="{{ rule.field_full }} :: {{ rule.sources_display }} :: {{ rule.example }}" style="display:none;">
                <td>
                  {% if rule.origin=='source' %}
                    <span class="badge bg-danger">DATA SOURCE 1</span>
                  {% elif rule.origin=='legacy' %}
                    <span class="badge bg-dark">DATA SOURCE 2</span>
                  {% elif rule.origin[:2]|lower == 'ds' %}
                    <span class="badge bg-secondary">DATA SOURCE {{ rule.origin[2:]|int }}</span>
                  {% else %}
                    <span class="badge bg-secondary">{{ rule.origin|upper }}</span>
                  {% endif %}
                </td>
                <td>
                  <div class="field-stack" data-field-full="{{ rule.field_full }}" data-field-name="{{ rule.field_name }}">
                    <strong class="field-label">{{ rule.field_full }}</strong>
                    {% set _tbl = rule.target_table or (rule.field_full.split('.')[0] if '.' in rule.field_full else '') %}
                    {% if _tbl %}<span class="tbl">{{ _tbl }}</span>{% endif %}
                  </div>
                </td>
                <td class="text-muted">{{ rule.sources_display }}</td>
                <td>
                  <div class="d-flex gap-2 align-items-center">
                    <input type="text" name="rule_{{ loop.index0 }}" value="{{ rule.rule }}" class="form-control form-control-sm" />
                    {% if rule.variants %}
                    <select class="form-select form-select-sm" name="preferred_{{ loop.index0 }}" title="Preferred variant" data-current="{{ rule.preferred|e if rule.preferred else '' }}">
                      <option value="">Preferred…</option>
                      {% for v in rule.variants %}
                      <option value="{{ v }}">{{ v }}</option>
                      {% endfor %}
                    </select>
                    <button type="button" class="btn btn-outline-secondary btn-xs apply-selected" data-index="{{ loop.index0 }}" title="Apply selected variant">Apply</button>
                    {% endif %}
                  </div>
                </td>
                <td class="text-muted">
                  {# Format example as Expression/Result to make syntax obvious #}
                  {% set ex_raw = (rule.example or '') %}
                  {% set ex_txt = ex_raw.replace('Example:','').strip() %}
                  {% set parts = ex_txt.split('=>') %}
                  <div class="ex-box">
                    <div class="ex-line">
                      <div class="ex-seg"><span class="ex-label">Expr</span><span class="ex-code">{{ (parts[0] if parts|length>0 else ex_txt)|trim }}</span></div>
                      {% if parts|length>1 %}
                        <div class="ex-seg"><span class="ex-label">Result</span><span class="ex-code">{{ parts[1]|trim }}</span></div>
                      {% endif %}
                      {% if rule.variants %}
                        <div class="ex-seg flex-grow-1">
                          <span class="variant-toggle" role="button" tabindex="0" title="Show variants">VARIANT</span>
                          <div class="variant-list d-none" title="Click a variant to use it">
                            {% for v in rule.variants %}
                              <span class="variant-link" title="{{ v }}">{{ v }}</span>{% if not loop.last %}<span class="variant-sep">•</span>{% endif %}
                            {% endfor %}
                          </div>
                        </div>
                      {% endif %}
                    </div>
                  </div>
                </td>
                <td><button type="button" class="btn btn-outline-danger btn-sm edit-rule-btn" data-index="{{ loop.index0 }}">Edit</button></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-3">
      <div class="card h-100 shadow-sm graph-card">
        <div class="card-header bg-light text-danger fw-bold">Rules Mapping</div>
        <div class="card-body">
          <div id="rules-graph" class="mermaid small"></div>
          <div id="rules-graph-note" class="small text-muted mt-2"></div>
        </div>
      </div>
    </div>
  </div>
  
</form>

{% include 'poc4/_chatpanel.j2' %}

<!-- Mermaid for rules mapping diagram -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

<script>
  // Page-specific ChatPanel commands (Rules page)
  window.handleChatCommand = function(cmd, api){
    const t = (cmd||'').trim().toLowerCase();
    if(t.startsWith('apply rule ')){
      const i = parseInt(t.replace('apply rule ','').trim());
      api.append('assistant', `Will apply rule ${i}`);
      api.setLastAction(()=>{ const btn=document.querySelector(`.apply-selected[data-index='${i}']`); btn?.click(); });
      return true;
    }
    if(['validate','run validate','simulate','validate & simulate'].includes(t)){
      api.append('assistant','Will validate & simulate');
      api.setLastAction(()=> document.getElementById('validate-btn')?.click());
      return true;
    }
    if(t.startsWith('minimize ds1') || t.includes('minimize source')){ api.append('assistant','Will minimize DS1'); api.setLastAction(()=> document.getElementById('minimize-source')?.click()); return true; }
    if(t.startsWith('minimize ds2') || t.includes('minimize legacy')){ api.append('assistant','Will minimize DS2'); api.setLastAction(()=> document.getElementById('minimize-legacy')?.click()); return true; }
    return false;
  };
  function editRule(i){ const inp=document.querySelector(`input[name='rule_${i}']`); if(!inp) return; const val=prompt('Edit rule:', inp.value); if(val!==null){ inp.value=val; } }
  document.querySelectorAll('.edit-rule-btn').forEach(btn=>{ btn.addEventListener('click', ()=> editRule(parseInt(btn.dataset.index))); });
  // Apply selected variant (single button per row)
  document.querySelectorAll('.apply-selected').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const idx = parseInt(btn.dataset.index);
      const sel = document.querySelector(`select[name='preferred_${idx}']`);
      const inp = document.querySelector(`input[name='rule_${idx}']`);
      if (!sel || !inp) return;
      const val = sel.value;
      if (val) { inp.value = val; inp.focus(); }
    });
  });
  // ChatPanel starts collapsed by default

  // Filter origin toggles with persistence (DS1/DS2 default OFF, DS3+ default ON)
  const filterSource = document.getElementById('filter-source');
  const filterLegacy = document.getElementById('filter-legacy');
  const extraFilters = Array.from(document.querySelectorAll('.filter-extra'));
  const ORIGIN_FILTERS_KEY = 'poc4_origin_filters';
  const ORIGIN_MIN_KEY = 'poc4_origin_min';
  function loadFilterPrefs(){ try{ return JSON.parse(localStorage.getItem(ORIGIN_FILTERS_KEY)||'{}')||{}; }catch(e){ return {}; } }
  function saveFilterPrefs(state){ try{ localStorage.setItem(ORIGIN_FILTERS_KEY, JSON.stringify(state||{})); }catch(e){} }
  function currentFilterState(){
    const stored = loadFilterPrefs();
    const state = { ...stored };
    if(filterSource) state['source'] = !!filterSource.checked;
    if(filterLegacy) state['legacy'] = !!filterLegacy.checked;
    extraFilters.forEach(cb=>{ const o=(cb.dataset.origin||'').toLowerCase(); if(o){ state[o]=!!cb.checked; }});
    return state;
  }
  function applyStoredPrefs(){
    const stored = loadFilterPrefs();
    if(filterSource){ filterSource.checked = !!stored['source']; }
    if(filterLegacy){ filterLegacy.checked = !!stored['legacy']; }
    extraFilters.forEach(cb=>{ const o=(cb.dataset.origin||'').toLowerCase(); cb.checked = (o in stored) ? !!stored[o] : true; });
  }
  function isOn(origin, state){
    const o = (origin||'').toLowerCase();
    if(o in state) return !!state[o];
    return (o !== 'source' && o !== 'legacy');
  }
  function applyFilters(){
    const state = currentFilterState();
    document.querySelectorAll('.rule-row[data-origin]').forEach(row=>{
      const origin = (row.getAttribute('data-origin') || '').toLowerCase();
      const ok = isOn(origin, state);
      row.style.display = ok ? 'table-row' : 'none';
    });
    saveFilterPrefs(state);
  try{ applyMin(); }catch(e){}
  }
  filterSource?.addEventListener('change', applyFilters);
  filterLegacy?.addEventListener('change', applyFilters);
  extraFilters.forEach(cb=> cb.addEventListener('change', applyFilters));
  applyStoredPrefs();
  applyFilters();
  // After applying filters, update the mapping diagram
  try{ renderRulesGraph(); }catch(e){}

  // Minimize per origin (collapse rows but keep filter state)
  function getMin(){ try{ return JSON.parse(localStorage.getItem(ORIGIN_MIN_KEY)||'{}')||{}; }catch(e){ return {}; } }
  function setMin(k,v){ try{ const s=getMin(); s[k]=!!v; localStorage.setItem(ORIGIN_MIN_KEY, JSON.stringify(s)); }catch(e){} }
  function applyMin(){
    const s=getMin();
    document.querySelectorAll('.rule-row[data-origin]').forEach(row=>{
      const o=(row.getAttribute('data-origin')||'').toLowerCase();
      const minimized = !!s[o];
      row.style.display = row.style.display; // keep filter effect
      row.classList.toggle('collapsed-origin', minimized);
      row.style.visibility = minimized? 'collapse' : '';
    });
  }
  document.getElementById('minimize-source')?.addEventListener('click', ()=>{ const s=getMin(); setMin('source', !s['source']); applyMin(); });
  document.getElementById('minimize-legacy')?.addEventListener('click', ()=>{ const s=getMin(); setMin('legacy', !s['legacy']); applyMin(); });
  document.querySelectorAll('.minimize-extra').forEach(btn=>{
    btn.addEventListener('click', ()=>{ const o=(btn.dataset.origin||'').toLowerCase(); const s=getMin(); setMin(o, !s[o]); applyMin(); });
  });
  applyMin();
  // Update graph after minimize actions
  try{ renderRulesGraph(); }catch(e){}

  // Toggle qualified/unqualified
  const toggle = document.getElementById('toggleQualified');
  const PREF_KEY = 'poc4_rules_show_qualified';
  // Load preference
  const storedPref = localStorage.getItem(PREF_KEY);
  if(storedPref !== null){ toggle.checked = storedPref === '1'; }
  function applyQualification(){
    const showQualified = toggle.checked;
    document.querySelectorAll('.field-stack').forEach(fs=>{
      const full = fs.getAttribute('data-field-full');
      const nameOnly = fs.getAttribute('data-field-name') || full;
      const labelEl = fs.querySelector('.field-label');
      if(labelEl){ labelEl.textContent = showQualified ? full : nameOnly.split('.').slice(-1)[0]; }
      // Always show table line (requirement: display table name along with field)
      const tblEl = fs.querySelector('.tbl');
      if(tblEl){ tblEl.style.display = 'block'; }
    });
  }
  toggle.addEventListener('change', ()=>{ localStorage.setItem(PREF_KEY, toggle.checked ? '1':'0'); applyQualification(); });
  applyQualification();

  // Initialize preferred dropdowns
  document.querySelectorAll('select[name^="preferred_"]').forEach(sel => {
    const cur = sel.getAttribute('data-current');
    if (cur) {
      for (const opt of sel.options) {
        if (opt.value === cur) { opt.selected = true; break; }
      }
    }
  });
  // Keep quick actions synced via ChatPanel handler

  // --- Rules Mapping Graph (Mermaid) ---
  function safeId(s){ return (String(s||'').replace(/[^a-zA-Z0-9_]/g,'_')); }
  function labelForOrigin(o){
    const x = (o||'').toLowerCase();
    if(x==='source') return 'DATA SOURCE 1';
    if(x==='legacy') return 'DATA SOURCE 2';
    if(x.startsWith('ds')){ const n=parseInt(x.slice(2))||''; return `DATA SOURCE ${n}`; }
    return (o||'').toString().toUpperCase();
  }
  function collectVisibleRules(){
    const rows = [];
    document.querySelectorAll('tr.rule-row').forEach(tr=>{
  const cs = getComputedStyle(tr);
  const st = cs.display;
  const vis = cs.visibility;
  if(st !== 'table-row') return; // filtered out
  if(vis === 'collapse') return; // minimized origin
      const origin = tr.getAttribute('data-origin')||'';
      const originLabel = labelForOrigin(origin);
      // find target table label
      const fs = tr.querySelector('.field-stack');
      let table = '';
      if(fs){
        table = (fs.querySelector('.tbl')?.textContent||'').trim();
        if(!table){
          const full = fs.getAttribute('data-field-full')||'';
          table = full.includes('.')? full.split('.')[0] : '';
        }
      }
      rows.push({ origin: originLabel, table });
    });
    return rows;
  }
  function buildRulesGraphDef(rows){
    const counts = new Map();
    const origins = new Set();
    const tables = new Set();
    rows.forEach(r=>{
      const o = r.origin||''; const t = r.table||'';
      if(!o || !t) return;
      const key = o+'||'+t;
      counts.set(key, (counts.get(key)||0)+1);
      origins.add(o); tables.add(t);
    });
  let def = 'flowchart LR\n';
  origins.forEach(o=>{ def += `${safeId(o)}([${o}]):::origin\n`; });
  tables.forEach(t=>{ def += `${safeId('t_'+t)}([${t}]):::target\n`; });
    counts.forEach((n,key)=>{
      const [o,t] = key.split('||');
      def += `${safeId(o)} -->|${n}| ${safeId('t_'+t)}\n`;
    });
    def += 'classDef origin fill:#ffe8e6,stroke:#d32f2f,color:#b71c1c,stroke-width:1px;\n';
    def += 'classDef target fill:#eef2ff,stroke:#4f46e5,color:#1f2937,stroke-width:1px;\n';
    return def;
  }
  function renderMermaidOnce(el, def){
    if(!window.mermaid || !el) return;
    el.classList.remove('is-rendered');
    try{ mermaid.initialize({ startOnLoad:false, securityLevel:'loose' }); }catch(e){}
    try{
      // Prefer rendering to SVG and injecting it
      if(typeof mermaid.render === 'function'){
        const uid = 'm_'+Math.random().toString(36).slice(2);
        mermaid.render(uid, def).then(({svg, bindFunctions})=>{
          el.innerHTML = svg;
          if(typeof bindFunctions === 'function'){ bindFunctions(el); }
          el.classList.add('is-rendered');
        }).catch(()=>{ el.textContent = def; });
      } else if(typeof mermaid.run === 'function'){
        el.textContent = def;
        mermaid.run({ nodes: [el] }).then(()=>{ el.classList.add('is-rendered'); }).catch(()=>{});
      } else if(typeof mermaid.init === 'function'){
        el.textContent = def;
        mermaid.init(undefined, [el]);
        el.classList.add('is-rendered');
      } else {
        el.textContent = def;
      }
    }catch(e){ el.textContent = def; }
  }
  function mermaidReady(){ return typeof window.mermaid !== 'undefined'; }
  function renderRulesGraph(){
    const el = document.getElementById('rules-graph');
    const note = document.getElementById('rules-graph-note');
    if(!el) return;
    const rows = collectVisibleRules();
    const tables = Array.from(new Set(rows.map(r=> r.table).filter(Boolean)));
    const origins = Array.from(new Set(rows.map(r=> r.origin).filter(Boolean)));
    const total = rows.length;
  const def = buildRulesGraphDef(rows);
  setTimeout(()=> renderMermaidOnce(el, def), 0);
    if(note){ note.innerHTML = `Tables: <strong>${tables.length}</strong> · Rules: <strong>${total}</strong> · Origins: ${origins.join(', ')||'—'}`; }
  }
  // Initial render (after Mermaid is ready)
  function tryRenderInitial(){ if(mermaidReady()) { try{ renderRulesGraph(); }catch(e){} return true; } return false; }
  if(!tryRenderInitial()){
    let tries = 0; const t = setInterval(()=>{ if(tryRenderInitial()){ clearInterval(t); } if(++tries>20){ clearInterval(t); } }, 200);
  }
  window.addEventListener('load', ()=>{ try{ renderRulesGraph(); }catch(e){} });

  // Toggle variant list per row via the VARIANT label
  document.querySelectorAll('.variant-toggle').forEach(tg =>{
    tg.addEventListener('click', ()=>{
      const row = tg.closest('tr.rule-row');
      const list = row?.querySelector('.variant-list');
      if(list){ list.classList.toggle('d-none'); }
    });
    tg.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===' '){ e.preventDefault(); tg.click(); }
    });
  });

  // Clicking a variant text fills the rule input and syncs Preferred dropdown (if present)
  document.querySelectorAll('.variant-link').forEach(el => {
    el.addEventListener('click', () => {
      const tr = el.closest('tr.rule-row');
      if (!tr) return;
      const text = el.textContent.trim();
      const input = tr.querySelector('input[name^="rule_"]');
      if (input) { input.value = text; input.focus(); }
      const sel = tr.querySelector('select[name^="preferred_"]');
      if (sel) {
        for (const opt of sel.options) {
          if (opt.value === text) { opt.selected = true; break; }
        }
      }
    });
  });
</script>
<!-- Help Modal (Page 3: Rules) -->
<div class="modal fade" id="helpModalP3" tabindex="-1" aria-labelledby="helpModalP3Label" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-light">
        <h5 class="modal-title" id="helpModalP3Label">Help — Transformation Rules</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p><strong>What this page does</strong></p>
        <p>Define the transformation logic to convert origin fields into your target model. Suggestions come from mappings and semantics extracted earlier (akin to POC 3b’s clarifications).</p>
        <p><strong>What you need to do</strong></p>
        <ul class="help-list">
          <li>Review recommended rules and pick a preferred variant when available.</li>
          <li>Use Apply All to quickly set recommended rules per origin.</li>
          <li>Adjust expressions and examples as needed for your domain.</li>
          <li>Validate & Simulate to see results before running migration.</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
