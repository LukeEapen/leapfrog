<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agentic AI (LangGraph Enhanced)</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8fbff;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1100px;
      margin: auto;
    }
    textarea, button {
      font-size: 14px;
    }
    textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 10px;
      resize: vertical;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      margin-top: 10px;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .section {
      background: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    .section h3 {
      margin-top: 0;
      color: #333;
    }
    .output {
      background: #f4f4f4;
      border: 1px solid #ddd;
      padding: 10px;
      font-family: monospace;
      white-space: pre-wrap;
      border-radius: 4px;
      min-height: 80px;
    }
    .alert {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .alert-success {
      background-color: #d4edda;
      color: #155724;
    }
    .alert-error {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>LangGraph-Based Agentic AI Interface</h2>
  <div id="statusBanner"></div>
  <div class="section">
    <label><strong>Capability</strong></label>
    <textarea id="capability"></textarea>
    <label><strong>Use Case</strong></label>
    <textarea id="useCase"></textarea>
    <label><strong>Description</strong></label>
    <textarea id="description" rows="4"></textarea>
    <button onclick="submitAgent1()">Submit to Agent 1</button>
  </div>

  <div class="section">
    <h3>Agent 1: Intent Clarifier</h3>
    <div id="agent1_output" class="output"></div>
    <button onclick="submitAgent2()">Approve & Run Agent 2</button>
  </div>

  <div class="section">
    <h3>Agent 2: Requirement Generator</h3>
    <div id="agent2_output" class="output"></div>
    <button onclick="submitAgent3()">Approve & Run Agent 3</button>
  </div>

  <div class="section">
    <h3>Agent 3: Validator</h3>
    <div id="agent3_output" class="output"></div>
    <button onclick="submitAgent4()">Approve & Run Agents 5â€“8</button>
  </div>

  <div class="section">
    <h3>Agent 4: LRC, NFR, Arch, Functional</h3>
    <div id="agent4_output" class="output"></div>
  </div>
</div>

<script>
  let fullQuestion = "";

  function buildPrompt() {
    const cap = document.getElementById("capability").value.trim();
    const use = document.getElementById("useCase").value.trim();
    const desc = document.getElementById("description").value.trim();
    return `Capability = '${cap}', Use Case = '${use}', Description = '${desc}'`;
  }

  function showStatus(message, isError = false) {
    const banner = document.getElementById("statusBanner");
    banner.innerHTML = `<div class="alert ${isError ? 'alert-error' : 'alert-success'}">${message}</div>`;
    setTimeout(() => banner.innerHTML = '', 5000);
  }

  async function fetchAgent() {
    try {
      const response = await fetch("/api/query_agents", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: fullQuestion })
      });
      const data = await response.json();
      if (response.ok) {
        showStatus("Success: Agent step completed.");
        return data;
      } else {
        throw new Error(data.error || "Unknown error");
      }
    } catch (err) {
      showStatus(`Error: ${err.message}`, true);
      return {};
    }
  }

  async function submitAgent1() {
    fullQuestion = buildPrompt();
    const res = await fetchAgent();
    document.getElementById("agent1_output").innerHTML = marked.parse(res.agent_1 || "No response");
  }

  async function submitAgent2() {
    const res = await fetchAgent();
    document.getElementById("agent2_output").innerHTML = marked.parse(res.agent_2 || "No response");
  }

  async function submitAgent3() {
    const res = await fetchAgent();
    document.getElementById("agent3_output").innerHTML = marked.parse(res.agent_3 || "No response");
  }

  async function submitAgent4() {
    const res = await fetchAgent();
    document.getElementById("agent4_output").innerHTML = marked.parse(res.agent_4 || "No response");
  }
</script>
</body>
</html>
