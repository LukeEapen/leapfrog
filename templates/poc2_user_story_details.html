<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Story Drafting Solution</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background-color: #f5f5f5;
      color: #333;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
    }
    .main-container {
      max-width: 900px;
      margin: 20px auto;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .top-bar {
      background-color: #dc3545;
      color: white;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      position: relative;
    }
    .back-button {
      background: none;
      border: none;
      color: white;
      font-size: 14px;
      cursor: pointer;
      padding: 4px 0;
    }
    .back-button:hover {
      text-decoration: underline;
      color: white;
    }
    .jira-notice {
      text-align: center;
      background: #dc3545;
      color: white;
      padding: 8px;
      margin: 0;
      font-weight: bold;
    }
    .story-header {
      background-color: #4a5568;
      color: white;
      padding: 12px 16px;
      margin: 0;
      font-size: 16px;
      font-weight: 500;
    }
    .story-header {
      background-color: #4a5568;
      color: white;
      padding: 12px 16px;
      margin: 0;
      font-size: 16px;
      font-weight: 500;
    }
    .content-container {
      background: white;
      margin: 0;
      padding: 24px;
    }
    .epic-info-section {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e2e8f0;
    }
    .epic-label {
      color: #dc3545;
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .epic-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }
    .info-row {
      display: flex;
      gap: 24px;
      margin-bottom: 8px;
    }
    .info-item {
      display: flex;
      align-items: center;
      font-size: 14px;
    }
    .info-label {
      font-weight: 600;
      margin-right: 8px;
      color: #666;
    }
    .priority-high {
      color: #dc3545;
      font-weight: 600;
    }
    .section-container {
      margin-bottom: 16px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      background: white;
      overflow: hidden;
    }
    .section-header {
      background-color: #4a5568;
      color: white;
      padding: 10px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      font-size: 14px;
    }
    .section-content {
      padding: 16px;
      line-height: 1.6;
      color: #333;
    }
    .chat-btn {
      background: none;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .chat-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    .requirements-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .requirements-list li {
      padding: 8px 0;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
      color: #333;
    }
    .requirements-list li:last-child {
      border-bottom: none;
    }
    .criteria-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .criteria-list li {
      padding: 6px 0;
      color: #333;
      font-size: 14px;
      position: relative;
      padding-left: 16px;
    }
    .criteria-list li:before {
      content: "â€¢";
      position: absolute;
      left: 0;
      color: #666;
    }
    .submit-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
    }
    .submit-btn:hover {
      background-color: #c82333;
      color: white;
    }
    .hidden {
      display: none;
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
      .main-container {
        margin: 10px;
        max-width: none;
      }
    }
    
    @media (max-width: 768px) {
      .main-container {
        margin: 5px;
        border-radius: 4px;
      }
      .content-container {
        padding: 16px;
      }
      .info-row {
        flex-direction: column;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- Top Navigation Bar -->
    <div class="top-bar">
      <button class="back-button" onclick="goBack()">
        &lt; Back
      </button>
      <span style="position: absolute; right: 16px; top: 8px; font-size: 12px;">
        Use the 'Chat' interface to ask questions and edit outputs
      </span>
    </div>

    <!-- Jira Ticket Creation Notice -->
    <div class="jira-notice">
      Jira ticket creation
    </div>

    <!-- User Story Header -->
    <div class="story-header">
      {% if multiple_stories %}
        Multiple User Stories: {{ story_count }} stories selected
      {% else %}
        User story: {{ user_story_name or 'Capture personal information during onboarding' }}
      {% endif %}
    </div>

    <!-- Main Content -->
    <div class="content-container">
    <!-- Epic Information Section -->
    <div class="epic-info-section">
      <div class="epic-label">Epic:</div>
      <div class="epic-title">{{ epic_title or 'End-to-End Customer Account Creation' }}</div>
      
      <div class="info-row">
        <div class="info-item">
          <span class="info-label">Priority:</span>
          <span class="priority-high">{{ priority or 'High' }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Responsible systems:</span>
          <span>{{ responsible_systems or 'CAPS, CMS, ...' }}</span>
        </div>
      </div>
    </div>

    <!-- Description Section -->
    <div class="section-container">
      <div class="section-header">
        <span>Description</span>
        <button class="chat-btn" onclick="openDescriptionChat()">
          <span>ðŸ’¬ Chat</span>
        </button>
      </div>
      <div class="section-content">
        {% if multiple_stories %}
          <!-- Multiple Stories Summary -->
          <div class="multiple-stories-summary">
            <h6>Selected Stories ({{ story_count }}):</h6>
            {% for story in stories %}
              <div class="story-item" style="margin-bottom: 12px; padding: 8px; border-left: 3px solid #dc3545; background: #f8f9fa;">
                <strong>{{ story.name }}</strong>
                <p style="margin: 4px 0; font-size: 14px; color: #666;">{{ story.description }}</p>
                <small style="color: #999;">Priority: {{ story.priority }} | System: {{ story.system }}</small>
              </div>
            {% endfor %}
          </div>
        {% else %}
          {{ user_story_description or 'As a new borrower, I want to input my personal information (e.g., name, SSN) so that the system can accurately create my customer profile and initiate the onboarding process. This ensures that downstream verification steps (e.g. KYC, credit checks) can proceed without manual data correction or re-entry.' }}
        {% endif %}
      </div>
    </div>

    <!-- Acceptance Criteria Section -->
    <div class="section-container">
      <div class="section-header">
        <span>Acceptance criteria</span>
        <button class="chat-btn" onclick="openAcceptanceCriteriaChat()">
          <span>ðŸ’¬ Chat</span>
        </button>
      </div>
      <div class="section-content">
        <ul class="criteria-list">
          {% if acceptance_criteria %}
            {% for criterion in acceptance_criteria %}
            <li>{{ criterion }}</li>
            {% endfor %}
          {% else %}
          <li>System prompts for full name, date of birth, Social Security Number, email address, phone number, and residential address</li>
          <li>Mandatory fields must be completed before progressing</li>
          <li>Input formats are validated (e.g., MM/DD/YYYY for DOB, 9-digit SSN, phone with area code)</li>
          <li>Errors are surfaced clearly and immediately for any missing or invalid entries</li>
          {% endif %}
        </ul>
      </div>
    </div>

    <!-- Tagged Requirements Section -->
    <div class="section-container">
      <div class="section-header">
        <span>Tagged requirements</span>
        <button class="chat-btn" onclick="openRequirementsChat()">
          <span>ðŸ’¬ Chat</span>
        </button>
      </div>
      <div class="section-content">
        <ul class="requirements-list">
          {% if tagged_requirements %}
            {% for requirement in tagged_requirements %}
            <li>{{ requirement }}</li>
            {% endfor %}
          {% else %}
          <li>F1. Capture Personal Information for New Customer Account</li>
          <li>KDA2. Customer full name</li>
          <li>KDA3. Customer date of birth</li>
          <li>KDA4. Customer SSN or equivalent</li>
          {% endif %}
        </ul>
      </div>
    </div>

    <!-- Submit Button -->
    <button type="submit" class="submit-btn" onclick="submitToJira()">
      Submit & export to Jira
    </button>
    </div>
  </div>

  <!-- Hidden form with data for Jira submission -->
  <form id="jira-form" action="/submit-jira-ticket" method="POST" style="display: none;">
    <input type="hidden" name="epic_title" value="{{ epic_title or '' }}">
    <input type="hidden" name="user_story_name" value="{{ user_story_name or '' }}">
    <input type="hidden" name="user_story_description" value="{{ user_story_description or '' }}">
    <input type="hidden" name="priority" value="{{ priority or 'High' }}">
    <input type="hidden" name="responsible_systems" value="{{ responsible_systems or 'CAPS, CMS' }}">
    <input type="hidden" name="acceptance_criteria" value="{% if acceptance_criteria %}{{ acceptance_criteria|join('|||') }}{% else %}System prompts for full name, date of birth, Social Security Number, email address, phone number, and residential address|||Mandatory fields must be completed before progressing|||Input formats are validated (e.g., MM/DD/YYYY for DOB, 9-digit SSN, phone with area code)|||Errors are surfaced clearly and immediately for any missing or invalid entries{% endif %}">
    <input type="hidden" name="tagged_requirements" value="{% if tagged_requirements %}{{ tagged_requirements|join('|||') }}{% else %}F1. Capture Personal Information for New Customer Account|||KDA2. Customer full name|||KDA3. Customer date of birth|||KDA4. Customer SSN or equivalent{% endif %}">
  </form>

<script>
  function goBack() {
    window.history.back();
  }

  function submitToJira() {
    // Simply submit the hidden form
    document.getElementById('jira-form').submit();
  }

  function openDescriptionChat() {
    alert('Description chat functionality will be implemented soon');
  }

  function openAcceptanceCriteriaChat() {
    alert('Acceptance criteria chat functionality will be implemented soon');
  }

  function openRequirementsChat() {
    alert('Requirements chat functionality will be implemented soon');
  }
</script>
</body>
</html>
