<!--
  PRD Assistant Input Page

  Description:
  This HTML template renders the input form for a Product Requirements Document (PRD) drafting assistant. 
  It provides a structured UI for users to supply product context, upload supporting files, and describe 
  the product and its features. The assistant uses this input to generate a first-draft PRD.

  Features:
  - Responsive, modern UI styled with Bootstrap 5 and custom CSS.
  - Instructions and guidance for users on how to provide effective input.
  - Input fields for industry, sector, geography, and file upload (TXT/DOC/DOCX).
  - Textareas for detailed product and feature descriptions.
  - Real-time form validation with visual feedback (valid/invalid states).
  - Animated loading spinner and processing indicator on form submission.
  - Accessibility features (labels, placeholders, visually hidden loading text).
  - Customizable via external CSS and JS files.

  Usage:
  - Place this template in your Flask app's templates directory.
  - Ensure static assets (custom.css, global.js) are available in the static directory.
  - The form submits via POST to the "/page1" endpoint and supports file uploads.
  - JavaScript handles validation and loading state UX.

  Dependencies:
  - Bootstrap 5.3.0 (CSS)
  - Bootstrap Icons 1.7.2
  - Google Fonts (Inter)
  - Custom CSS and JS (referenced via Flask's url_for)
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>PRD Assistant Input</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='custom.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">

  <style>
    /* Root Variables */
    :root {
      --primary-red: #dc3545;
      --primary-red-dark: #c82333;
      --primary-grey: #343a40;
      --secondary-grey: #6c757d;
      --light-grey: #f8f9fa;
      --gradient-red: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      --gradient-grey: linear-gradient(135deg, #343a40 0%, #495057 100%);
      --card-shadow: 0 8px 24px rgba(220, 53, 69, 0.12);
      --border-radius: 0.75rem;
      --transition-speed: 0.3s;
      --input-bg: #f9fafb;
    }

    /* Page Layout */
    body {
      background-color: #343a40;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem 1rem;
      font-family: 'Inter', sans-serif;
      color: var(--primary-grey);
    }

    /* Card Styling */
    .input-card {
      background: rgba(255, 255, 255, 0.98);
      padding: 2rem;
      margin: 0.75rem;
      border-radius: var(--border-radius);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      max-width: 1600px;
      width: 100%;
      margin: 1rem;
      animation: fadeIn 0.5s ease-out;
    }

    /* Header Styles */
    h4 {
      color: var(--primary-red);
      font-weight: 600;
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      /* Reduced from 2rem */
      padding-bottom: 0.375rem;
      /* Reduced from 0.5rem */
      border-bottom: 2px solid rgba(220, 53, 69, 0.1);
    }

    /* Section Titles */
    .section-title {
      background: var(--gradient-grey);
      color: white;
      font-weight: 600;
      padding: 0.625rem 1.25rem;
      /* Reduced from 0.75rem 1.5rem */
      border-radius: var(--border-radius);
      margin-bottom: 1rem;
      /* Reduced from 1.5rem */
      box-shadow: 0 4px 15px rgba(52, 58, 64, 0.15);
    }

    /* Instructions Box */
    .instructions-box {
      background: var(--input-bg);
      padding: 1.25rem;
      border-radius: var(--border-radius);
      border: 1px solid rgba(0, 0, 0, 0.08);
      margin-bottom: 1.5rem;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
    }

    .instructions-box p {
      color: var(--primary-grey);
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    .instructions-box ul {
      padding-left: 1.2rem;
      margin-bottom: 0;
    }

    .instructions-box li {
      color: var(--secondary-grey);
      margin-bottom: 0.5rem;
    }

    .instructions-box strong {
      color: var(--primary-grey);
      font-weight: 600;
    }

    /* Form Elements */
    .form-label {
      color: var(--primary-grey);
      font-weight: 500;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
    }

    .form-label i {
      color: var(--primary-red);
      margin-right: 0.5rem;
    }

    .form-control {
      background-color: var(--input-bg);
      border: 1px solid #dee2e6;
      border-radius: var(--border-radius);
      padding: 0.75rem 1rem;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }

    .form-control:focus {
      border-color: var(--primary-red);
      box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.15);
    }

    .form-control::placeholder {
      color: #adb5bd;
      opacity: 0.8;
    }

    /* Form Row Spacing */
    .row.g-4 {
      --bs-gutter-y: 0.75rem;
      /* Reduced from default */
    }

    .row.g-3 {
      --bs-gutter-y: 0.75rem;
      /* Reduced from default */
    }

    /* Form Group Spacing */
    .mb-4 {
      margin-bottom: 1rem !important;
      /* Reduced from 1.5rem */
    }

    textarea.form-control {
      min-height: 120px;
      resize: vertical;
    }

    /* File Input Styling */
    input[type="file"].form-control {
      padding: 0.375rem 0.75rem;
    }

    input[type="file"].form-control::-webkit-file-upload-button {
      background: var(--gradient-grey);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      margin-right: 1rem;
    }

    /* Submit Button */
    .btn-danger {
      background: var(--gradient-red);
      border: none;
      height: 3.5rem;
      font-size: 1.1rem;
      font-weight: 500;
      border-radius: var(--border-radius);
      transition: all var(--transition-speed) ease;
    }

    .btn-danger:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
      background: linear-gradient(135deg, #c82333 0%, #dc3545 100%);
    }

    .btn-danger:disabled {
      background: var(--secondary-grey);
      cursor: not-allowed;
      transform: none;
    }

    /* Loading States */
    #loadingSpinner {
      background: rgba(255, 255, 255, 0.98);
      padding: 1.5rem;
      border-radius: var(--border-radius);
      margin-top: 1rem;
      box-shadow: var(--card-shadow);
      display: none;
    }

    .loading-animation {
      animation: pulse 1.5s infinite;
    }

    /* Validation States */
    .form-control.is-valid {
      border-color: #198754;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
      padding-right: calc(1.5em + 0.75rem);
      background-repeat: no-repeat;
      background-position: right calc(0.375em + 0.1875rem) center;
      background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }

    .form-control.is-invalid {
      border-color: var(--primary-red);
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.5;
        transform: scale(0.98);
      }

      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      body {
        padding: 1rem 0.5rem;
      }

      .input-card {
        padding: 1.25rem;
        margin: 0.375rem;
      }

      h4 {
        font-size: 1.25rem;
      }

      .section-title {
        padding: 0.5rem 1rem;
      }
    }

    /* Legacy section highlight */
    .legacy-optional {
      background: linear-gradient(180deg, #fff7e6 0%, #fffaf0 100%);
      border: 2px dashed #ffecb5;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 16px rgba(255, 193, 7, 0.12);
    }
    .legacy-optional .legacy-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }
    .legacy-optional .badge-new {
      background: #ffc107;
      color: #212529;
      font-weight: 700;
    }
    .legacy-help {
      color: #7a5c00;
    }

    /* How To: Floating Help and Offcanvas Guide */
    .howto-fab {
      position: fixed;
      right: 24px;
      bottom: 24px;
      z-index: 1055;
      border-radius: 999px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }
  </style>

</head>

<body>
  <div class="input-card animate__animated animate__fadeIn">
    <h4 class="mb-4">PRD drafting solution | Context and file upload</h4>

    <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
      <span>Instructions: Using the PRD drafting solution</span>
    </div>
    <div class="instructions-box">
      <p>This agentic AI assistant accelerates the creation of a first-draft Product Requirements Document (PRD) based
        on the product and features you define. By guiding you through a structured input process, it delivers a clear
        and actionable draft – freeing you to focus on refinement, alignment, and execution.</p>
      <ul>
        <li>Provide relevant context, including industry, product details, + documentation that define the product’s
          functionality – <strong>provide as much detail & context as possible</strong></li>
        <li>Upload any supporting materials to strengthen the tool’s understanding and improve the quality of the output
        </li>
        <li>Review and refine the tool’s understanding of the product & features</li>
        <li>Once all sections are complete, download your initial PRD draft, ready for refinement and stakeholder
          feedback</li>
      </ul>

      <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
        <span>Inputs </span>
      </div>
      <div class="instructions-box">

        <form method="post" action="/page1" enctype="multipart/form-data">
          <div class="row g-3 mb-4">
            <div class="row g-4 mb-4">
              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-building me-2"></i>Industry
                </label>
                <input type="text" class="form-control" name="industry" placeholder="e.g., Financial Services" required>
              </div>

              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-diagram-3 me-2"></i>Sector
                </label>
                <input type="text" class="form-control" name="sector" placeholder="e.g., Banking, Insurance" required>
              </div>

              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-globe me-2"></i>Geography
                </label>
                <input type="text" class="form-control" name="geography" placeholder="e.g., USA, Canada" required>
              </div>

              <div class="col-md-6">
                <label class="form-label text-muted">
                  <i class="bi bi-file-earmark-text me-2"></i>Additional Context
                </label>
                <input type="file" class="form-control" name="context_file" accept=".txt,.doc,.docx">
                <small class="text-muted">Upload product-related context files (TXT/DOC)</small>
              </div>
            </div>

            <!-- Legacy Upload Row (COBOL/JCL) - NEW / Optional -->
            <div class="legacy-optional p-3 mb-4">
              <div class="legacy-header">
                <div class="h6 m-0"><i class="bi bi-archive me-2"></i>Legacy Artifacts</div>
                <span class="badge badge-new rounded-pill">NEW • Optional</span>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">
                    <i class="bi bi-file-earmark-code me-2"></i>Legacy COBOL/JCL File(s)
                  </label>
                  <input type="file" class="form-control" id="legacyFileInput" name="legacy_files[]" accept=".cob,.cbl,.cpy,.jcl,.txt" multiple>
                  <small class="legacy-help">Upload one or more COBOL/JCL files or use the folder selector</small>
                </div>
                <div class="col-md-6">
                  <label class="form-label">
                    <i class="bi bi-folder2-open me-2"></i>Legacy Folder (multiple files)
                  </label>
                  <input type="file" class="form-control" id="legacyFolderInput" name="legacy_files[]" webkitdirectory directory multiple>
                  <small class="legacy-help">Select a folder containing COBOL/JCL files</small>
                </div>
                <div class="col-12 d-flex align-items-center gap-2">
                  <button type="button" class="btn btn-light border" id="extractLegacyBtn">
                    Extract Legacy Business Description
                  </button>
                  <span class="small" id="legacyStatus"></span>
                </div>
              </div>
              <!-- Hidden fields: description + selection flag -->
              <input type="hidden" name="legacy_business_description" id="legacyBusinessHidden">
              <input type="hidden" name="legacy_selected" id="legacySelectedHidden" value="false">
            </div>

            <div class="mb-4">
              <label class="form-label">What is the product / platform that you are trying to build?</label>
              <textarea name="intent" class="form-control" rows="4"
                placeholder="Insert product description here. Include purpose, target audience, platform (web/mobile/etc.), and any relevant context – provide as much detail for your product as possible to give the tool sufficient context to write the PRD."
                required></textarea>
            </div>
            <div class="mb-4">
              <label class="form-label">What specific features will this PRD cover?</label>
              <textarea name="features" class="form-control" rows="4"
                placeholder="Insert detailed description of the feature here. Be sure to describe what the feature does, how users interact with it, what it must integrate with or support technically, what data it requires or generates, and any important performance, security, or UX constraints."
                required></textarea>
            </div>
            <div class="d-grid mt-4">
              <button type="submit" id="submitBtn" class="btn btn-danger btn-lg w-100" onclick="handleSubmit(event)">
                <span class="default-text">Submit</span>
                <span class="loading-text d-none">Processing...</span>
              </button>
            </div>
          </div>
        </form>

        <div id="loadingSpinner" class="d-flex text-muted justify-content-center">
          <span id="loadingTimer">⏳ 0s</span>
        </div>
      </div>
    </div>

  </div>

  <!-- How To: Floating Help and Offcanvas Guide -->
  <button type="button" class="btn btn-danger howto-fab" data-bs-toggle="offcanvas" data-bs-target="#howToPanel" aria-controls="howToPanel" title="How To (Shift + ?)">
    <i class="bi bi-question-circle-fill"></i>
  </button>

  <div class="offcanvas offcanvas-end" tabindex="-1" id="howToPanel" aria-labelledby="howToLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="howToLabel">How To: Get Started</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ol class="mb-3">
        <li>Fill out Industry, Sector, Geography, Intent, and Features.</li>
        <li>(Optional) Upload a PRD and legacy files/folders to enrich outputs.</li>
        <li>Submit to run background agents; you will review results on the next page.</li>
      </ol>
      <div class="mb-2"><strong>Tips</strong></div>
      <ul>
        <li>Be concise but specific in Intent and Features to steer better outputs.</li>
        <li>Legacy uploads enable a “Legacy Business Description” and citations later.</li>
        <li>You can edit any generated text on the review page before finalizing.</li>
      </ul>
      <div class="text-muted small mt-3">Shortcut: Press Shift + ? to open this guide.</div>
    </div>
  </div>

  <script>
    function handleSubmit(event) {
      event.preventDefault();

      const form = event.target.closest('form');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const submitBtn = document.getElementById('submitBtn');
      const defaultText = submitBtn.querySelector('.default-text');
      const loadingText = submitBtn.querySelector('.loading-text');

      submitBtn.disabled = true;
      submitBtn.classList.remove('btn-danger');
      submitBtn.classList.add('btn-secondary');

      defaultText.classList.add('d-none');
      loadingText.classList.remove('d-none');

      // Enhanced loading spinner
      document.getElementById('loadingSpinner').innerHTML = `
        <div class="d-flex align-items-center justify-content-center">
            <div class="spinner-border text-primary me-2" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <span class="loading-animation" id="loadingTimer">Processing request...</span>
        </div>
    `;

      document.getElementById('loadingSpinner').style.display = 'block';
      startSpinner();

      form.submit();
    }


    document.addEventListener('DOMContentLoaded', function () {
      const formInputs = document.querySelectorAll('.form-control');

      formInputs.forEach(input => {
        // Add validation styles on input
        input.addEventListener('input', function () {
          validateInput(this);
        });

        // Add validation styles on blur
        input.addEventListener('blur', function () {
          validateInput(this);
        });
      });

      function validateInput(input) {
        if (input.checkValidity()) {
          input.classList.add('is-valid');
          input.classList.remove('is-invalid');
        } else {
          input.classList.add('is-invalid');
          input.classList.remove('is-valid');
        }
      }
    });

    document.querySelector('input[name="context_file"]').addEventListener('change', function () {
      const maxSizeKB = 100;
      const file = this.files[0];
      if (file && file.size > maxSizeKB * 1024) {
        alert(`File exceeds ${maxSizeKB}KB. Please choose a smaller file.`);
        this.value = ''; // Clear the file input
      }
    });

    // Keyboard shortcut: Shift + ?
    document.addEventListener('keydown', function(e){
      if (e.shiftKey && (e.key === '?' || e.key === '/')) {
        const panel = document.getElementById('howToPanel');
        if (!panel) return;
        const off = bootstrap.Offcanvas.getOrCreateInstance(panel);
        off.toggle();
      }
    });
  </script>
  
  <!-- Toast container for legacy extraction notifications -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
    <div id="legacyToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="legacyToastBody">Legacy description extracted ✓</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>
  <script>
    // Handle Legacy extraction using a backend API, store in hidden field + localStorage
    (function () {
      const btn = document.getElementById('extractLegacyBtn');
      if (!btn) return;
  const statusEl = document.getElementById('legacyStatus');
      const fileInput = document.getElementById('legacyFileInput');
      const folderInput = document.getElementById('legacyFolderInput');
      const hidden = document.getElementById('legacyBusinessHidden');
  const legacySelectedHidden = document.getElementById('legacySelectedHidden');
      function markLegacySelected() {
        localStorage.setItem('legacySelected', 'true');
        if (legacySelectedHidden) legacySelectedHidden.value = 'true';
      }
      fileInput?.addEventListener('change', () => {
        if (fileInput.files && fileInput.files.length) markLegacySelected();
      });
      folderInput?.addEventListener('change', () => {
        if (folderInput.files && folderInput.files.length) markLegacySelected();
      });

      function showToast(message, variant = 'success') {
        const toastEl = document.getElementById('legacyToast');
        const bodyEl = document.getElementById('legacyToastBody');
        if (!toastEl || !bodyEl) return;
        bodyEl.textContent = message;
        toastEl.classList.remove('text-bg-success', 'text-bg-danger');
        toastEl.classList.add(variant === 'success' ? 'text-bg-success' : 'text-bg-danger');
        const toast = new bootstrap.Toast(toastEl, { delay: 2500 });
        toast.show();
      }

      function setStatus(msg, isError = false) {
        if (!statusEl) return;
        statusEl.textContent = msg;
        statusEl.classList.toggle('text-danger', !!isError);
        statusEl.classList.toggle('text-success', !isError);
      }

      async function pickFolderFilesIfNeeded(existingFiles) {
        // If no folder files and File System Access API is available, prompt user
        if (existingFiles.length && (!window.showDirectoryPicker)) return [];
        try {
          if (!window.showDirectoryPicker) return [];
          const dirHandle = await window.showDirectoryPicker();
          const collected = [];
          const allowed = new Set(['.cob', '.cbl', '.cpy', '.jcl', '.txt']);
          async function walkDir(handle, path = '') {
            for await (const [name, entry] of handle.entries()) {
              const currentPath = path ? `${path}/${name}` : name;
              if (entry.kind === 'file') {
                const ext = (name.substring(name.lastIndexOf('.')) || '').toLowerCase();
                if (!allowed.size || allowed.has(ext)) {
                  const file = await entry.getFile();
                  // Recreate File with path prefix to retain folder structure in name
                  const f2 = new File([file], currentPath, { type: file.type, lastModified: file.lastModified });
                  collected.push(f2);
                }
              } else if (entry.kind === 'directory') {
                await walkDir(entry, currentPath);
              }
            }
          }
          await walkDir(dirHandle);
          return collected;
        } catch (e) {
          console.warn('Folder picker cancelled or failed:', e);
          return [];
        }
      }

      btn.addEventListener('click', async () => {
        try {
          let files = [];
          if (fileInput?.files?.length) files.push(...fileInput.files);
          if (folderInput?.files?.length) files.push(...folderInput.files);

          // Fallback: prompt for a folder if none provided or browser didn’t expose folder selection
          if (!files.length) {
            const picked = await pickFolderFilesIfNeeded(files);
            if (picked.length) files = picked;
          }

          if (!files.length) {
            setStatus('Please select a legacy file or folder first.', true);
            return;
          }

          const fd = new FormData();
          for (const f of files) fd.append('legacy_files[]', f, f.name);

          setStatus('Extracting from legacy files…');
          const resp = await fetch('/api/legacy-business-description', { method: 'POST', body: fd });
          if (!resp.ok) throw new Error('Extraction failed');
          const data = await resp.json();
          const desc = (data && (data.description || data.legacy_description)) || '';
          if (!desc) throw new Error('No description returned');

          // Persist for Page 2 and include in main form submit
          localStorage.setItem('legacyBusinessDescription', desc);
          localStorage.setItem('legacySelected', 'true');
          if (hidden) hidden.value = desc;
          if (legacySelectedHidden) legacySelectedHidden.value = 'true';
          setStatus('Legacy description extracted ✓');
          showToast('Legacy description extracted ✓', 'success');
        } catch (e) {
          console.error(e);
          setStatus('Failed to extract legacy description', true);
          showToast('Failed to extract legacy description', 'danger');
        }
      });
    })();
  </script>
  <!-- Bootstrap JS bundle for toast functionality -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- How To: Floating Help Button and Offcanvas Guide -->
  <style>
    .howto-fab {
      position: fixed;
      right: 24px;
      bottom: 24px;
      z-index: 1055;
      border-radius: 999px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
  </style>
  <button type="button" class="btn btn-danger howto-fab" data-bs-toggle="offcanvas" data-bs-target="#howToPanel" aria-controls="howToPanel" title="How To (Shift + ?)">
    <i class="bi bi-question-circle-fill"></i>
  </button>
  <div class="offcanvas offcanvas-end" tabindex="-1" id="howToPanel" aria-labelledby="howToLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="howToLabel">How To: Inputs & Uploads</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ol class="mb-3">
        <li>Fill Industry, Sector, and Geography to frame the domain.</li>
        <li>Describe Product Intent and Features clearly and concisely.</li>
        <li>(Optional) Upload PRD and Legacy files/folder to enrich outputs.</li>
        <li>Click “Extract from Legacy” to prebuild a business description.</li>
        <li>Submit to generate Product and Feature overviews on the next page.</li>
      </ol>
      <div class="mb-2"><strong>Tips</strong></div>
      <ul>
        <li>Be specific with outcomes and constraints to guide better drafts.</li>
        <li>Legacy uploads enable citations and business-friendly requirements.</li>
        <li>You can edit and chat with the assistant on the review pages.</li>
      </ul>
      <div class="text-muted small mt-3">Shortcut: Press Shift + ? to open this guide.</div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/global.js') }}"></script>
  <script>
    // Keyboard shortcut: Shift + ?
    document.addEventListener('keydown', function(e){
      if (e.shiftKey && (e.key === '?' || e.key === '/')) {
        const panel = document.getElementById('howToPanel');
        if (!panel || !window.bootstrap) return;
        const off = bootstrap.Offcanvas.getOrCreateInstance(panel);
        off.toggle();
      }
    });
  </script>
</body>

</html>